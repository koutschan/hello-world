\documentclass{sig-alternate}
\let\proof\undefined
\let\endproof\undefined
\usepackage{amsthm,amssymb,amsmath}
\usepackage{graphics}
\usepackage{bbm}
\usepackage{tikz}
\usepackage[plainpages=false,pdfpagelabels,colorlinks=true,citecolor=blue,hypertexnames=false]{hyperref}
\usepackage{color}
\overfullrule=1mm

\newtheorem{theorem}{Theorem}
\newtheorem{notation}[theorem]{Convention}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{defi}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{fact}[theorem]{Fact}
\def\qed{\quad\rule{1ex}{1ex}}
\def\ord{\operatorname{ord}}
\def\<#1>{\langle#1\rangle}

\newcommand{\red}{\color{red}}
\newcommand{\blue}{\color{blue}}
\newcommand{\bQ}{ {\mathbb Q}}
\newcommand{\bA}{ {\mathbb A}}
\newcommand{\bE}{ {\mathbb E}}
\newcommand{\bB}{ {\mathbb B}}
\newcommand{\cB}{ {\mathcal B}}
\newcommand{\bC}{ {\mathbb C}}
\newcommand{\bF}{ {\mathbb F}}
\newcommand{\bN}{ {\mathbb N}}
\newcommand{\bZ}{ {\mathbb Z}}
\newcommand{\bK}{ {\mathbb K}}
\newcommand{\cM}{ {\mathcal M}}
\newcommand{\cN}{ {\mathcal N}}
\newcommand{\cS}{ {\mathcal S}}
\newcommand{\cO}{ {\mathcal O}}
\newcommand{\cE}{ {\mathcal E}}
\newcommand{\cP}{ {\mathcal P}}
\newcommand{\den } {{\rm den}}
\newcommand{\num }{{\rm num}}
\newcommand{\de } {\delta}
\newcommand{\pa}{\partial}
\newcommand{\spanning}{\text{span}}

\overfullrule=1ex

\newcommand{\ve} {{\bf e}}
\newcommand{\vp} {{\bf p}}
\newcommand{\vv} {{\bf v}}
\newcommand{\vq} {{\bf q }}
\newcommand{\vx} {{\bf x}}

\let\set\mathbbm
\def\lc{\operatorname{lc}}
\def\rank{\operatorname{rank}}
\def\lt{\operatorname{lt}}
\def\im{\operatorname{Im}}
\def\lclm{\operatorname{lclm}}

\begin{document}

\title{Reduction~Based Creative~Telescoping for \\ Fuchsian D-finite~Functions}

\numberofauthors{1}

\author{\medskip
Shaoshi Chen$^{1,2}$, \, Manuel Kauers$^{3}$, \, Christoph Koutschan$^{4}$ \\
\smallskip
       \affaddr{$^1$KLMM,\, AMSS, \,Chinese Academy of Sciences, Beijing, 100190, (China)}\\
       \smallskip
       \affaddr{$^2$SCG, Faculty of Mathematics, University of Waterloo, Ontario, N2L3G1, (Canada)}\\
              \smallskip
       \affaddr{$^3$Institute for Algebra, Johannes Kepler University, Altenberger Stra\ss e 69,
 A-4040 Linz, (Austria)}\\
        \smallskip
       \affaddr{$^4$RICAM, Austrian Academy of Sciences, Altenberger Stra\ss e 69, A-4040 Linz, (Austria)}\\
       \smallskip
      \email{schen@amss.ac.cn, manuel.kauers@jku.at}\\
      \email{christoph.koutschan@ricam.oeaw.ac.at}
%Preliminary notes
}




\maketitle
%
\begin{abstract}
  // TODO
\end{abstract}


\category{I.1.2}{Computing Methodologies}{Symbolic and Algebraic Manipulation}[Algebraic Algorithms]

\terms{Algorithms, Theory}

\keywords{Algebraic function, Integral basis, Trager's Reduction, Telescoper}

%\bigskip

\section{Introduction}\label{SECT:intro}

The classical question in symbolic integration is whether the integral of
a given function can be written in ``closed form''. In its most restricted form,
the question is whether for a given function~$f$ belonging to some domain $D$
there exists another function~$g$, also belonging to~$D$, such that $f=g'$. For
example, if $D$ is the field of rational functions, then for $f=1/x^2$ we can
find $g=-1/x$, while for $f=1/x$ no suitable $g$ exists. When no $g$ exists
in~$D$, there are several other questions we may ask. One possibility is to ask
whether there is some extension~$E$ of $D$ such that in $E$ there exists some
$g$ with $g'=f$. For example, in the case of elementary functions, Liouville's
principle restricts the possible extensions~$E$, and algorithms have been
designed to construct these extensions whenever possible. Another possibility is
to ask whether for some modification $\tilde f\in D$ of~$f$ there exists a $g\in
D$ such that $\tilde f=g'$. Creative telescoping is a question of this
type. Here we are dealing with domains~$D$ containing functions in several
variables, say $x$ and~$t$, and the question is whether there is a linear
differential operator~$P$, nonzero and free of~$x$, such that there exists a
$g\in D$ with $P\cdot f=g'$, where $g'$ denotes the derivative of $g$ with
respect to~$x$. Typically, $g$~itself has the form $Q\cdot f$ for some operator
$Q$ (which may be zero and need not be free of~$x$). In this case, we call $P$
a telescoper for~$f$, and $Q$ a certificate for~$P$.

Creative telescoping is the backbone of definite integration. Readers not
familiar with this technique are refered to the literature~\cite{PWZbook1996,Zeilberger1990c,Zeilberger1991,Zeilberger1990,Koepf1998}
for motivation, theory, algorithms, implementations, and applications. There are
several ways to find telescopers for a given $f\in D$. In recent years, an
approach has become popular which has the feature that it can find a telescoper
without also constructing the corresponding certificate. This is interesting
because certificates tend to be much larger than telescopers, and in some
applications only the telescoper is of interest. This approach was first
formulated for rational functions $f\in C(t,x)$ in~\cite{BCCL2010} and later
generalized to rational functions in several variables~\cite{bostan13}, to
hyperexponential functions~\cite{bostan13a} and, for the shift case, to hypergeometric
terms~\cite{chen15a} and binomial sums~\cite{bostan15}. In the present paper, we will extend
the approach to fuchsian D-finite functions.

The basic principle of the general approach is as follows. Assume that the
$x$-constants $\mathrm{Const}_x(D)=\{\,c\in D:c'=0\,\}$ form a field, i.e., that $D$
is a vector space over the field of $x$-constants. Assume further that there is
some $\mathrm{Const}_x(D)$-linear map $[\cdot]\colon D\to D$ such that for every
$f\in D$ there exists a $g\in D$ with $f-[f]=g'$. Such a map is called a
\emph{reduction.} For example, in $D=C(t,x)$ Hermite reduction produces for
every $f\in D$ some $g$ such that $f-g'$ is either zero or a rational function
with a square-free denominator. In this case, we can take $[f]=f-g'$.
In order to find a telescoper, we can compute $[f]$, $[D_t\cdot f]$, $[D_t^2\cdot f]$, \dots,
until we find that they are linearly dependent over $\mathrm{Const}_x(D)$.
When we find a relation
$p_0[f] + \cdots + p_r[D_t^r\cdot f] = 0$,
then, by linearity,
$[p_0 f + \cdots + p_r D_t^r\cdot f] = 0$,
and then, by definition of $[\cdot]$, there exists a $g\in D$ such that $(p_0+\cdots + p_rD_t^r)\cdot f=g'$.
In other words, $P=p_0+\cdots + p_rD_t^r$ is a telescoper.

There are two ways to guarantee that this method works. The first consists in
showing that $\{\,[f]:f\in D\,\}$ is a finite dimensional vector space over
$\mathrm{Const}_x(D)$. This approach was taken in~\cite{BCCL2010,bostan13a}. It has the
nice additional feature that every bound for the dimension of this vector space
gives rise to a bound for the order of the telescoper. In particular, it implies
the existence of a telescoper. The second way requires that we already know for
other reasons that a telescoper exists. The idea is then to show that the
reduction $[\cdot]$ has the property that when $f\in D$ is such that there
exists a $g\in D$ with $g'=f$, then $[f]=0$. If this is the case and
$P=p_0+\cdots+p_rD_t^r$ is a telescoper for~$f$, then $P\cdot f$ is integrable
in~$D$, so $[P\cdot f]=0$, and by linearity $[f]$, \dots, $[D_t^r\cdot f]$ are
linearly dependent over $\mathrm{Const}_x(D)$. This means that the method won't
miss any telescoper. In particular, this argument has the nice feature that we
are guaranteed to find a telescoper of smallest possible order~$r$. This
approach was taken in~\cite{chen15a}.

Using an analog of Trager's Hermite reduction for algebraic
functions~\cite{trager84,geddes92}  adapted to fuchsian D-finite functions, we provide an
algorithm for finding the minimal order telescoper in Section~\ref{sec:hermite} using the
first argument. We then proceed to describe in Section~\ref{sec:polynomial} an additional
reduction which in combination with the Hermite reduction ensures that the
remainders live in a finite dimensional vector space [IF THE REDUCTION
WORKS]. This gives a new proof of a bound for the order of the telescopers,
and in particular an independent proof for their existence.

\section{Fuchsian D-finite Functions}

Let $C$ be a field. We consider linear differential operators
$L=\ell_0+\cdots+\ell_rD_x^r$ with $\ell_0,\dots,\ell_r$ belonging to some ring
$R$ containing $C$.
Typicall choices for $R$ will be $C[x]$ or $C[[x]]$ or~$C(x)$.
When $\ell_r\neq0$, we say that $\ord(L):=r$ is the order of~$L$.

We write $R[D_x]$ for the algebra consisting of all these operators, together
with the usual addition and the unique non-commutative multiplication satisfying
$D_xc=cD_x$ for all $c\in C$ and $D_xx=xD_x+1$.
The algebra $R[D_x]$ acts on a differential $R$-module~$F$ via
\[
  (\ell_0+\ell_1D_x+\cdots+\ell_rD_x^r)\cdot f=
   \ell_0f + \ell_1f' + \cdots + \ell_r f^{(r)}.
\]
An element $y\in F$ is called a solution of an operator $L\in R[D_x]$ if
$L\cdot y=0$.

An operator $L$ of order~$r$ is called fuchsian at a point $a\in\bar C$ if
it admits $r$ linearly independent solutions in
\[
  \bar C[[[x-a]]] := \bigcup_{\nu\in C} (x-a)^\nu\bar C[[x-a]][\log(x-a)],
\]
where $\bar C$ denotes the algebraic closure of~$C$. It is called fuchsian
at $\infty$ if it admits $r$ linearly independent solutions in
\[
  \bar C[[[x^{-1}]]] := \bigcup_{\nu\in C} x^{-\nu} \bar C[[x^{-1}]][\log(x)].
\]
It it simply called \emph{fuchsian} if it is fuchsian at all $a\in\bar C\cup\{\infty\}$.

For a fixed fuchsian operator $L$, we will consider the left-$R[D_x]$-module
$A=R[D_x]/\<L>$, where $\<L>$ denotes the left ideal generated by~$L$ in
$R[D_x]$.  Then $1\in A$ is a solution of~$L$, because we have $L\cdot 1=L=0$
in~$A$. We can say that $A$ consists of all the ``functions'' $f$ which can be
obtained from a ``generic'' solution~$y$ of $L$ by applying some operator $P\in
R[D_x]$ to it. When $R$ is a field, then $A$ is an $R$-vector space of
dimension~$r=\ord(L)$, generated by $1,D_x,\dots,D_x^{r-1}$.

It is instructive to compare this setup to the situation for algebraic
functions. Comparing $A=R[D_x]/\<L>$ to an algebraic function field $R[Y]/\<M>$
(when $R$ is a field), our operator $L$ plays the role of the minimal
polynomial~$M$. In the algebraic case, $Y$~is a formal solution of the equation
$M=0$, similar as $1\in A$ is a formal solution of~$L$. Besides these formal
solutions there are, for each fixed $a\in\bar C$, exactly $\deg(M)$ different
Puiseux series solutions of $M=0$ at places above~$a$. They correspond in the
differential setting to the series solutions of $L$ in $\bar C[[[x-a]]]$, which
generate a $\bar C$-vector space of dimension $\ord(L)$.

In the context of creative telescoping, we use $C=k(t)$ as constant field, where
$t$ is another variable. Integration will always be with respect to~$x$, but
besides the derivation $D_x$ there is now also the derivation with respect
to~$t$. The action of $D_t$ on elements of $\bar C[[[x-a]]]$ or $\bar
C[[[x^{-1}]]]$ is defined coefficient-wise. It is clear that $D_x$ and $D_t$
commute. For the action of $D_t$ on~$A$, we assume that $D_t\cdot D_x = D_x\cdot
(D_t\cdot 1)$ in $A$ and that in addition to $L$ we know some other operator $\tilde
L\in k(t,x)[D_x]$ such that $D_t\cdot 1=\tilde L\cdot 1$ in~$A$. The requirement
that $\tilde L$ exists amounts to saying that the ``function'' represented by
$1\in A$ should be D-finite as a bivariate function in $x$ and~$t$, for if its
annihilator in the operator algebra $k(t,x)[D_t,D_x]$ contains the operators $L$
and $D_t-\tilde L$, then its Hilbert-dimension is zero, and this is the usual
definition of D-finiteness in the case of several variables~\cite{zeilberger90,chyzak98,koutschan09,kauers14c}.
$\tilde L$ does not directly follow from the existence of~$L$. This is different
from the case of algebraic function fields, where a single minimal polynomial $M$
suffices even in the case of several variables.

\section{Integral Bases}

Trager's Hermite reduction for algebraic functions rests on the notion of
integral bases. The notion of integral bases has been generalized to D-finite
functions last year~\cite{kauers15b}, and an algorithm was also given there for
computing such bases. We recall here the relevant definitions and properties.

Although the elements of a generalized series ring $C[[[x-a]]]$ are formal
objects, the series notation suggests certain analogies with complex
functions.  For simplicity, let us assume throughout that $C\subseteq\set
R$. Terms $(x-a)^\alpha\log(x-a)^\beta$ or $(\tfrac1x)^\alpha\log(x)^\beta$ are
called \emph{integral} if $\alpha>0$ or $\alpha=\beta=0$.
Integrality thus means that the corresponding complex
function does not diverge at the reference point~$a$ (the reference point is
$\infty$ in the case of $(\tfrac1x)^\alpha\log(x)^\beta$). A series in
$C[[[x-a]]]$ or $C[[[x^{-1}]]]$ is called integral if it only contains integral
terms. A non-integral series is said to have a \emph{pole} at the reference
point.  Note that in this terminology also $1/\sqrt{x}$ and $\log(x)$ have
``poles'' at~$0$, although the usual terminology reserves the word pole for
asymptotic behaviour which agrees with $x^n$ for some negative integer~$n$.

Let $L\in C(x)[D_x]$ be a fuchsian operator. An element $P\in A=C(x)[D_x]/\<L>$
is called (locally) integral at $a\in C\cup\{\infty\}$ if for every solution $f$
of $L$ in $C[[[x-a]]]$ or $C[[[x^{-1}]]]$, respectively, the series $P\cdot f$ is
integral. $P$~is called (globally) integral if it is locally integral at every
$a\in C$ (``at all finite places''). Because of the Fuchs relation~\cite{ince26}, an
element $P\in A$ is integral at every $a\in C\cup\{\infty\}$ if and only if it
is a constant (i.e., if $D_xP=0$ in~$A$).

The set of all integral elements $P\in A$ forms a $C[x]$-submodule of~$A$.
A basis $\{\omega_1,\dots,\omega_n\}$ of this module is called an \emph{integral basis}
for~$A$. In~\cite{kauers15b} an algorithm was given which computes an integral basis
for a given~$A$. This algorithm is a generalization of van Hoeij's
algorithm~\cite{kauers15b} for computing integral bases of algebraic function
fields.

For a fixed $a\in C$, let $C(x)_a$ be the ring of rational functions $p/q$
with $p(a)=0$ and $q(a)\neq0$, and write $C(x)_\infty$ for the ring of all
rational functions $p/q$ with $\deg(p)<\deg(q)$ (proper rational
functions). Then the set of all $P\in A$ which are locally integral at some
fixed $a\in C\cup\{\infty\}$ forms a $C(x)_a$-module. A basis of this module is
called a \emph{local integral basis} at $a$ for~$A$. The algorithm given in~\cite{kauers15b}
for computing (global) integral bases computes local integral bases at finite
points as an intermediate step. The computation of a local integral basis at
infinity is also possible, either analogously, or by making a change of
variables $\tilde x=1/x$ and computing a local integral basis at~$0$.

An integral basis $\omega_1,\dots,\omega_n$ is always also a $C(x)$-vector space
basis of~$A$. A key feature of integral bases is they make poles explicit. Writing
an element $f\in A$ as a linear combination $f=\sum_{i=1}^n f_i\omega_i$ for some
$f_i\in C(x)$, we have that $f$ has a pole at $a\in C$ if and only if at least one
of the $f_i$ has a pole there.

\begin{lemma}\label{lemma:1}
  Let $L$ be a fuchsian operator and let
  $\omega_1,\dots,\omega_n$ be a local integral basis of $A=C(x)[D_x]/\<L>$ at $a\in C\cup\{\infty\}$.
  Let $f\in A$ and $f_1,\dots,f_n\in C(x)$ be such that $f=\sum_{i=1}^nf_i\omega_i$.
  Then $f$ is integral at $a$ if and only if each $f_i\omega_i$ is integral at~$a$.
\end{lemma}
\begin{proof}
  The direction ``$\Rightarrow$'' is obvious. To show ``$\Leftarrow$'', suppose
  that $f$ is integral. Then there exist $w_1,\dots,w_n\in C(x)_a$ such that
  $f=\sum_{i=1}^nw_i\omega_i$. Then $\sum_{i=1}^n(w_i-f_i)\omega_i=0$, and then
  $w_i=f_i$ for all $i$, because $\omega_1,\dots,\omega_n$ is a basis.
  As elements of~$C(x)_a$, the $f_i$ are integral, and hence also all the $f_i\omega_i$
  are integral.
\end{proof}

The lemma says in particular that poles of the $f_i$ in a linear combination
$\sum_{i=1}^n f_i\omega_i$ have no chance to cancel each other.

It is important to observe that integrality is not preserved by differentiation.
For example, $x^{1/2}$ is integral but its derivative $\tfrac12 x^{-1/2}$ is
not. However, since differentiation of series is defined term by term, it is
clear that differentiation of an integral element cannot produce multiple
poles. More precisely, if $\nu$ is such that $f\in C[[[x-a]]]$ contains no term
$(x-a)^\alpha\log(x-a)^\beta$ for any $\alpha<\nu$, then $f'$ contains no term
$(x-a)^\alpha\log(x-a)^\beta$ for any $\alpha<\nu-1$, and if $f\in
C[[[x^{-1}]]]$ contains no term $x^\alpha\log(x)^\beta$ for any $\alpha>\nu$,
then $f'$ contains no term $x^\alpha\log(x)^\beta$ for any
$\alpha>\nu-1$. Another consequence of the same observation is the following
lemma.

\begin{lemma}
  Let $L$ be a fuchsian operator and let
  $\omega_1,\dots,\omega_n$ be an integral basis of $A=C(x)[D_x]/\<L>$.
  Let $e\in C[x]$ and
  $M=((m_{i,j}))_{i,j=1}^n\in C[x]^{n\times n}$ be such that
  \[
    e\,\omega_i'=\sum_{j=1}^n m_{i,j}\omega_j
  \]
  for $i=1,\dots,n$ and $\gcd(e,m_{1,1},\dots,m_{n,n})=1$.
  Then $e$ is square-free.
\end{lemma}
\begin{proof}
  Suppose that $e$ has a multiple root, say $(x-a)^2\mid e$ for some $a\in\bar
  C$. Since $\omega_i$ is integral for every~$i$ and differentiation cannot
  decrease exponents in series expansions by more than~1, $(x-a)\omega_i'$ is
  integral at $a$ for every~$i$.  Since $a$ is at least a double root of~$e$, it
  follows that $\sum_{j=1}^n\frac{m_{i,j}}{x-a}\omega_j$ is locally integral
  at~$a$ for every~$i$.  Because of $\gcd(e,m_{1,1},\dots,m_{n,n})=1$, at least
  one of the $\frac{m_{i,j}}{x-a}$ is not a polynomial.  This is impossible
  because $(x-a)\omega_i'$ is integral at $a$ and $\omega_1,\dots,\omega_n$ is
  an integral basis (and therefore in particular a local integral basis at~$a$).
\end{proof}

A $C(x)$-vector space basis $\omega_1,\dots,\omega_n$ of $C(x)[D_x]/\<L>$ is
called \emph{normal} at $a\in C\cup\{\infty\}$ if there exist $r_1,\dots,r_n\in
C(x)$ such that $r_1\omega_1,\dots,r_n\omega_n$ is a local integral basis
at~$a$. Trager shows for the case of algebraic function fields how to construct
an integral basis which is normal at infinity from a given integral basis and
a given local integral basis at infinity~\cite{trager84}. The same procedure also applies
in the present situation. It works as follows.

/// TODO.

Although normality is a somewhat weaker condition on a basis than integrality,
it also excludes the possibility that poles in the terms of a linear combination
of basis elements can cancel:

\begin{lemma}\label{lemma:3}
  Let $L$ be a fuchsian operator and let $\omega_1,\dots,\omega_n$ be an integral basis of $A=C(x)[D_x]/\<L>$
  which is normal at infinity.
  Let $f=\sum_{i=1}^n f_i\omega_i$ for some $f_1,\dots,f_n\in C[x]$.
  If $f$ has a pole at infinity, then there is some $i$ such that $f_i\omega_i$ has a pole at infinity.
\end{lemma}
\begin{proof}
  Let $r_1,\dots,r_n\in C(x)$ be such that $r_1\omega_1,\dots,r_n\omega_n$ is a
  local integral basis at infinity. Then $f=\sum_{i=1}^n
  (f_ir_i^{-1})(r_i\omega_i)$ and by Lemma~\ref{lemma:1}, $f$~is integral at infinity iff all
  $f_ir_i^{-1}r_i\omega_i=f_i\omega_i$ are integral at infinity.
\end{proof}


{\red Shaoshi: In the following, we are going to show that $\deg_x(m_{i,j})<\deg_x e$, just for the algebraic case.}


Let $K= C(x, y)$ be a finite algebraic extension of degree~$n$ over~$C(x)$. We assume that~$C$ is algebraically
closed. Let~$\mathcal{O}_\infty := \{p/q \in C(x) \mid \deg_x(p) \leq \deg_x(q)\}$ be the valuation ring of~$k(x)$
at the infinity
and $\mathcal{P}_\infty := \{p/q\in k(x) \mid \deg_x(p) < \deg_x(q)\}$ be the unique maximal ideal of~$\cO_\infty$,
which is a principal ideal generated by~$1/x$ in~$\cO_\infty$. Let~$\cP_1, \ldots, \cP_s$ be places of~$K$ which
lie above the place~$\cP_\infty$ of~$C(x)$ and~$\cO_i$ be the valuation ring of~$\cP_i$ for~$i=1, \ldots s$.
Let~$\cE_\infty := \{f\in K \mid \text{$f$ is integral over~$\cO_\infty$}\}$
and assume that $\{\omega_1, \ldots, \omega_n\}\subseteq \cE$ is a local integral basis of~$K$ over~$\cO_\infty$.
Let~$\upsilon_{\cP_i}$ denote the valuation map at the place~$\cP_i$.
By Lemma 4 in~\cite[p.\ 56]{Chevalley1951}, $\cE_\infty$ is the intersection of the rings~$\cO_i$'s, which
implies that $f \in \cE_\infty$ if and only if $\upsilon_{\cP_i}(f) \geq 0 $ for all~$i$ with~$1\leq i \leq s$.
Let~$t_i\in \cO_i$ be the uniformizing parameter at~$\cP_i$. Then~$1/x = t_i^{r_i}u_i$, where~$r_i\in \bN$ is the
ramification index of~$\cP_i$ and~$u_i\in K$ with~$\upsilon_{\cP_i}(u_i) = 0$. Since~$C$ is algebraically closed,
there always exists~$c_j\in C$ such that~$\upsilon_{\cP_i}(\omega_j - c_j) >0$ for each~$j=1, \ldots, n$.
Then Lemma 3 in~\cite[p.\ 49 ]{trager84} implies that for each~$i \in \{1, \ldots, s\}$,
\begin{align*}
\upsilon_{\cP_i} (x (\omega_j-c_j)')&  = \upsilon_{\cP_i}(x) + \upsilon_{\cP_i}((\omega_j-c_j)')\\
   & = -r_i + \upsilon_{\cP_i}((\omega_j-c_j)) + r_i\\
   & \geq \upsilon_{\cP_i}(\omega_j) \geq 0.
\end{align*}
Since~$\omega_j' = (\omega_j-c_j)'$, we have $x\omega_j' \in \cE_\infty$ for all~$j\in \{1, \ldots, n\}$.
Therefore, $x\omega_j' = \sum_{i=1}^n m_{j, i}\omega_i$ with~$m_{i, j}\in \cO_\infty$.
We have demonstrated the following lemma.

\begin{lemma} \label{lemma:degM}
Let~$\{\omega_1, \ldots, \omega_n\}$ be a local integral basis of~$K$ over~$\cO_\infty$.
Assume that~$e \omega_i' = \sum_{j=1}^n m_{i, j} \omega_j$ with~$e, m_{i, j}\in C[x]$.
Then~$\deg_x(m_{i,j})<\deg_x e$ for all $i, j$.
\end{lemma}
This lemma will be used in Section~\ref{sec:polynomial}.

\section{Hermite Reduction}\label{sec:hermite}

work out trager's hermite reduction for the fuchsian d-finite case. (actually, it is
literally the same as in the algebraic case.)

make no assumption on the regularity at infinity yet, because it is not needed for the
reduction but only for the theorem. also the assumption about ``normal at infinity'' is
not needed for the algorithm.

example.

theorem: if $f$ has a double root at infinity then the hermite remainder wrt an integral
basis that is normal at infinity is zero iff $f$ is integrable in the ``algebra''.

/// begin paste proof from note ///

``$\Rightarrow$'' is obvious, $g$ is the desired integral.

``$\Leftarrow$''. Assume that $f$ is integrable. Then also $h$ is integrable.
Let $H=\int h$.
In order to show that $h=0$, we show that $H$ is constant.
To show that $H$ is constant, we show that it has neither finite poles nor a pole at infinity.

It is clear that $H$ has no finite poles because $h$ has only ``simple'' poles (i.e., all Puiseux
expansions of $h$ have only exponents $\geq-1$).

We will show below that when $H$ has a pole at infinity, then also $g+H$ must have a pole at infinity.
Since $f=g'+h=(g+H)'$ has at least a double root at infinity, $g+H$ has at least
a single root at infinity. This excludes the possibility that $H$ has a pole at infinity.

Assume now that $H$ has a pole at infinity. We show that $g+H$ has also a pole at infinity.
Since $H$ has no finite poles, $H$ is integral and we can write it as
$H=p_1w_1+\cdots+p_nw_n$ with $p_i\in C[x]$.
Since we assume that $H$ has a pole at infinity, it follows that (a) one of the $p_i$ has positive degree
or (b) some nonconstant $w_i$ has a nonzero coefficient~$p_i$.
We know that $g=\sum_i b_iw_i$ with proper rational functions~$b_i$ (by how the algorithm works).
Consider $g+H=\sum_i (b_i+p_i)w_i$.
In case (a) there is some $i$ for which $b_i+p_i$ has a pole at infinity, then $(b_i+p_i)w_i$ has a pole
at infinity (because $w_i$ has no poles at finite places and therefore no zero at infinity),
and in case (b), there is some $i$ with $p_i\neq 0$ and $w_i$ is non-constant, then $(b_i+p_i)w_i$ has a
pole at infinity.
In both cases, therefore, $g+H$ has a pole at infinity because the basis is normal
at infinity (``MAIN PROPERTY'').
This completes the proof that $g+H$ has a pole at infinity. \rule{1ex}{1ex}

/// end paste proof from note ///

remark: double root at infinity can always be achieved by a change of variables.
double root persists by differentiating wrt. $t$. consequence: creative telescoping works.
(note: it is known that telescopers exist~\cite{zeilberger90,chyzak00}).
we find the minimal telescoper.

\section{Polynomial Reduction}\label{sec:polynomial}

second approach: we wish to show that the hermite remainders belong to a finite dimensional
vector space. in fact, this is not true.
note that the theorem does not imply that the hermite remainder is uniquely determined by
$f$ and the basis (it is not). it only makes a statement about the integrable case.

to make it true, we need to normalize the hermite remainder further. in view of the result
of the previous section, investing additional computational work seems pointless, because we have
already shown that repeated hermite reduction suffices to detect the minimal order telescoper.
in fact, the main point of the algorithm we discuss next is that it gives rise to a bound on
the telescoper. we will obtain an independent proof of the bound that already appeared in \cite{chen14a}.

===== shaoshi's text ahead =====

Let $K= C(x, y)$ be a finite algebraic extension of degree~$n$ over~$C(x)$.
Assume that~$\Omega:=\{\omega_1, \ldots, \omega_n\}$ be an integral basis of~$K$
over~$C[x]$.  Assume that
\[D_x(\omega_i) = \frac{1}{e}\sum_{j=1}^n m_{i, j}\omega_j,\]
where~$e, m_{i, j}\in C[x]$ such that the gcd of~$e$ and~$m_{i,j}$'s is~$1$.
Set~$M=(m_{i, j})\in C[x]^{n\times n}$
and
\[\deg_x(M):= \max\{\deg_x(m_{i, j})\}\]
%%\begin{lemma}\label{LEM:M}
%%$Q$ is squarefree and~$\deg_x(M) <= \deg_x(Q)-1$.
%%\end{lemma}
%%\begin{proof}{\red To be proved...}
%%\end{proof}
Any element~$\alpha\in K$ can be written as
\[\alpha = \sum_{i=1}^n \frac{a_i\omega_i}{d},\]
where~$a_i, d\in C[x]$. Applying Hermite reduction to~$\alpha$, we get
\[\alpha = D_x(\beta) + \sum_{i=1}^n \frac{c_i\omega_i}{d^*e},\]
where~$\beta\in K$, $d^*, e, c_i\in C[x]$, $\gcd(d^*, e)=1$ and~$d^*$ is squarefree.
By the extended Euclidean algorithm, we compute~$u_i, v_i\in C[x]$ such that
$\deg_x(v_i) < \deg_x(d^*)$ and
\[c_i = u_i d^* + v_i Q.\]
Then we get
\[ \sum_{i=1}^n \frac{c_i\omega_i}{d^*e} =  \sum_{i=1}^n \left(\frac{u_i}{e} + \frac{v_i}{d^*}\right)\omega_i.\]
In order to control the number of supporting monomials of~$u_i$'s, we now introduce the polynomial reduction.

By Lemma~\ref{lemma:degM}, $\deg_x(M)\leq \deg_x(e)-1$.
We first rewrite the polynomial matrix~$M\in C[x]^{n\times n}$ as a polynomial in~$x$
with matrix coefficients of the form
\[M = m_{\deg_x(M)}x^{\deg_x(M)} + \ldots + m_0, \]
where~$m_i\in C^{n\times n}$. Define the map:
\[\phi: C[x]^n \rightarrow C[x]^n\]
by~$\phi(p)= eD_x(p) + Mp$ for any~$p\in C[x]^n$. This map is $C[x]$-linear.
The image~$\im(\phi)$ is a subspace of~$C[x]^n$ as a vector space over~$C$.
Let~$\{\ve_1, \ldots, \ve_n\}$ be the standard basis of~$C^n$. Then the $C$-vector space~$C[x]^n$
is spanned by
\[\cS := \{\ve_ix^j \mid 1\leq i \leq n, j\in \bN\}.\]
For any~$p \in C[x]^n$, we can always write as
\[p = \vp_sx^s + \cdots + \vp_0,\]
where~$\vp_i\in C^n$ and~$\vp_s \neq 0$. We call $\vp_sx^s$
the \emph{leading term} of~$p$ in~$x$ and~$\vp_s$ the corresponding \emph{leading coefficient},
denoted by~$\lt_x(p)$ and~$\lc_x(p)$, respectively.
Let~$N_\phi$ be the subspace of~$C[x]^n$ spanned by
\[\{t \in \cS \mid s\neq \lt(p) ~\text{for all~$p\in \im(\phi)$}. \}\]
Then~$C[x]^n = \im(\phi) \oplus N_\phi$. We call~$N_{\phi}$ the \emph{standard complement} of~$\im(\phi)$.
In the next, we will estimate the dimension of~$N_\phi$ as a vector space over~$C$.


\noindent {\it Case 1.}~$\mu := \deg_x(M)<\deg_x(e)-1$. Let~$p\in C[x]^n$ with~$s=\deg_x(p)$.
If~$s=0$, then~$\phi(p) = Mp$, which implies that~$\deg_x(\phi(p))\leq \mu$.
Let~$\cS_\mu := \{\ve_i x^j \mid i=1, \ldots, n, 0\leq j\leq \mu\}$, which forms a vector basis
for the subspace~$C[x]_\mu^n$ of elements of $C[x]^n$ with degree at most~$\mu$. All of the columns~$M_i\in C[x]^n$ of~$M$
can be expanded as vectors~$V_i$ in~$C^{n(1+\mu)}$ with respect to the basis~$\cS_\mu$. Let~$\tilde{M} = (V_1, \ldots, V_n)\in C^{n(1+\mu) \times n}$.
Then for any~$p\in C^n$, $\phi(p) \in \text{span}_C\{V_1, \ldots, V_n\}$. The intersection of the standard complement~$N_\phi$
and~$C[x]_\mu^n$ has dimension~$n(1+\mu)-\text{rank}(\tilde{M})$. If~$s>0$, then
\[\phi(p)=\lc(e)s\lc(p)x^{s+\deg_x(e)-1} +~ \text{lower terms in~$x$}.\]
Therefore, any element~$q\in C[x]^n$ of degree at least~$\deg_x(e)$ can be written as
$q = \phi(q_1) + q_2$ for some~$q_1, q_2\in C[x]^n$ such that~$\deg_x(q_2)\leq \deg_x(e)-1$.
Moreover, all of the monomials~$\ve_ix^j$ with~$i=1, \ldots, n$ and~$\mu+1\leq j\leq \deg_x(e)-1$
are in the standard complement~$N_\phi$. Together with the estimate of the case~$s=0$, the dimension of
$N_\phi$ is $n(\deg_x(e)-1)-\text{rank}(\tilde{M})$.


\noindent {\it Case 2.}~$\mu =\deg_x(M)=\deg_x(e)-1$. Then for any~$p\in C[x]^n$ with~$s=\deg_x(p)$, we have
\[\phi(p) = (s\lc(e) + m_{\mu})\lc(p)x^{s+\mu}+\text{lower terms in~$x$}.\]
If~$-s\lc(e)\in C$ is not an eigenvalue of~$m_{\mu}\in C^{n\times n}$, then
the matrix~$J_s = s\lc(e) + m_{\mu}$ is invertible and then $\ve_ix^{s+\mu}$ is not in~$N_\phi$
for any~$i=1, \ldots, n$. Since~$m_\mu$ has at most~$n$ eigenvalues, the dimension of~$N_\phi$
is therefore at most~$n^2+n(\deg_x(e)-1)$.

Now let us find a basis for~$N_\phi$. Let~$s_1, \ldots, s_\rho$ with~$\rho\leq n$ be distinct nonnegative integers such that
$-s_i\lc(e)$ is an eigenvalue of~$m_{d-1}$ for each~$i=1, \ldots, \rho$.
Without lose of generality,
we assume that~$s_1 <s_2<\ldots<s_\rho$. For any~$s_i$ and~$\vv\in C^n$, the monomial $\vv x^{s_i}$ is not in~$N_\phi$
if and only if the linear system~$J_{s_i}\vx = \vv$
has a nonzero solution. This implies that there are $\sum_{i=1}^\rho (n-\rank(J_{s_i}))$ many linearly
independent elements in the basis~$\cS$ are in~$N_\phi$. If~$\vv = J_{s_i} \vp$ for some~$\vp\in C^n$, then
$\vv x^{s_i}$ can be reduced to a monomial of degree {\red To be continued...}

\begin{prop}\label{prop:Nphi}
The standard complement~$N_\phi$ of~$\phi$ has finite dimension over~$C$. Moreover,
$\dim(N_\phi) \leq ...$
\end{prop}

\section{Conclusion}

[[IF DESIRED]]

\bibliographystyle{abbrv}
\bibliography{Hermite}

\end{document}
